<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Meus arquivos</title>
<style>
 body{font-family:Arial;padding:16px;background:#f4f4f4}
 h1{text-align:center}
 table{width:100%;border-collapse:collapse;background:white;margin-top:12px}
 th,td{padding:10px;border:1px solid #ddd;vertical-align:middle}
 th{background:#4285F4;color:#fff}
 img.icon{width:22px;height:22px;margin-right:8px;vertical-align:middle}
 #loading{text-align:center;margin-top:20px}
 #breadcrumbs{margin-bottom:10px;font-size:14px}
 #breadcrumbs span{cursor:pointer;color:#4285F4}
</style>
</head>
<body>
<h1>Meus Arquivos</h1>
<div id="breadcrumbs"></div>
<div id="loading">Aguardando token...</div>
<table id="fileTable" style="display:none">
<thead><tr><th>Ícone</th><th>Nome</th><th>ID</th></tr></thead>
<tbody id="fileBody"></tbody>
</table>

<script>
let ACCESS_TOKEN = null;
let CURRENT_FOLDER = 'root';
let PATH_STACK = [{id:'root', name:'Meu Drive'}];

function setAccessToken(token) {
    ACCESS_TOKEN = token;
    listFiles();
}

function updateBreadcrumbs(){
    const bc = document.getElementById('breadcrumbs');
    bc.innerHTML = '';
    PATH_STACK.forEach((p,i)=>{
        const span = document.createElement('span');
        span.innerText = p.name;
        span.onclick = ()=>{
            PATH_STACK = PATH_STACK.slice(0,i+1);
            CURRENT_FOLDER = p.id;
            listFiles();
        };
        bc.appendChild(span);
        if(i < PATH_STACK.length-1) bc.appendChild(document.createTextNode(' / '));
    });
}

function listFiles(){
    if(!ACCESS_TOKEN){
        document.getElementById('loading').innerText = 'Token não disponível';
        return;
    }
    updateBreadcrumbs();
    document.getElementById('loading').style.display='block';
    document.getElementById('fileTable').style.display='none';
    fetch(`https://www.googleapis.com/drive/v3/files?q='${CURRENT_FOLDER}'+in+parents&fields=files(id,name,mimeType,iconLink)`, {
        headers: {'Authorization': 'Bearer ' + ACCESS_TOKEN}
    }).then(r=>r.json()).then(data=>{
        const tbody = document.getElementById('fileBody');
        tbody.innerHTML = '';
        if(data.files && data.files.length){
            data.files.forEach(file=>{
                let icon = file.iconLink || 'https://img.icons8.com/fluency/48/000000/document.png';
                if(file.mimeType==='application/vnd.google-apps.folder') icon='https://img.icons8.com/fluency/48/000000/folder-invoices.png';
                const tr = document.createElement('tr');
                const tdIcon = document.createElement('td');
                tdIcon.innerHTML = `<img class="icon" src="${icon}">`;
                const tdName = document.createElement('td');
                tdName.innerText = file.name;
                const tdId = document.createElement('td');
                tdId.innerText = file.id;
                tr.appendChild(tdIcon); tr.appendChild(tdName); tr.appendChild(tdId);
                // clique na linha: abrir/entrar
                tr.onclick = ()=>{
                    if(file.mimeType==='application/vnd.google-apps.folder'){
                        PATH_STACK.push({id:file.id,name:file.name});
                        CURRENT_FOLDER = file.id;
                        listFiles();
                    } else {
                        window.open(`https://drive.google.com/uc?id=${file.id}&export=download`, '_blank');
                    }
                };
                tbody.appendChild(tr);
            });
            document.getElementById('fileTable').style.display='table';
            document.getElementById('loading').style.display='none';
        } else {
            document.getElementById('loading').innerText = 'Nenhum arquivo encontrado.';
        }
    }).catch(e=>{
        document.getElementById('loading').innerText = 'Erro ao listar arquivos';
        console.error(e);
    });
}
</script>
</body>
</html>
